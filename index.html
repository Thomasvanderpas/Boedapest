<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scorebord</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button class="tab-button active" onclick="switchTab('home')">Home</button>
      <button class="tab-button" onclick="switchTab('rules')">Spelregels</button>
      <button class="tab-button" id="scoreboardTab" style="display: none;" onclick="switchTab('scoreboard')">Scorebord</button>
    </div>

    <!-- Homepage Tab -->
    <div id="home" class="tab-content active">
      <div class="homepage">
        <h1>Geldverpatsdag XXL - Pregames</h1>

        <!-- Week 1: Drankweek -->
        <section class="countdown-container">
          <h2 class="countdown-title" id="week1Title">Countdown naar<br>'Week 1'</h2>
          <div class="countdown-timer" id="countdownTimer-1">
            <div class="countdown-unit">
              <span class="countdown-number" id="days-1">--</span>
              <span class="countdown-label">Dagen</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="hours-1">--</span>
              <span class="countdown-label">Uren</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="minutes-1">--</span>
              <span class="countdown-label">Minuten</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="seconds-1">--</span>
              <span class="countdown-label">Seconden</span>
            </div>
          </div>
        </section>

        <div id="week1Tasks" class="week-tasks" style="display:none;">
          <h2 class="week-title">🎉 Week 1 Opdrachten zijn Nu Beschikbaar!</h2>
          <h3 class="theme-heading">🎯 Thema: Drank</h3>

          <div class="task-row">
            <div class="task-content">
              <h3>5 atjes op een avond inclusief videoproof</h3>
              <p></p>
            </div>
            <div class="task-score">5 pt</div>
          </div>

          <div class="task-row">
            <div class="task-content">
              <h3>Maak een XL Turbo shot voor jezelf en stuur een video dat je 'm neemt</h3>
              <p></p>
            </div>
            <div class="task-score">4 pt</div>
          </div>

          <div class="task-row">
            <div class="task-content">
              <h3>Gasolina met cola voor de color (normaal glas) met bijbehorende video</h3>
              <p></p>
            </div>
            <div class="task-score">3 pt</div>
          </div>

          <div class="task-row">
            <div class="task-content">
              <h3>Atje tripel/cocktail &gt;10% met bewijsmateriaal</h3>
              <p></p>
            </div>
            <div class="task-score">2 pt</div>
          </div>

          <div class="task-row">
            <div class="task-content">
              <h3>2 shotjes b2b (vrije keuze welke) wij willen een video</h3>
              <p></p>
            </div>
            <div class="task-score">1 pt</div>
          </div>
        </div>

        <!-- Week 2: Game week -->
        <section class="countdown-container">
          <h2 class="countdown-title" id="week2Title">Countdown naar<br>'Week 2'</h2>
          <div class="countdown-timer" id="countdownTimer-2">
            <div class="countdown-unit">
              <span class="countdown-number" id="days-2">--</span>
              <span class="countdown-label">Dagen</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="hours-2">--</span>
              <span class="countdown-label">Uren</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="minutes-2">--</span>
              <span class="countdown-label">Minuten</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="seconds-2">--</span>
              <span class="countdown-label">Seconden</span>
            </div>
          </div>
        </section>

        <div id="week2Tasks" class="week-tasks" style="display:none;">
          <h2 class="week-title">🎮 Week 2 – Game Week Opdrachten</h2>
          <div class="task-row">
            <div class="task-content">
              <h3>Doe een Cosplay van een karakter uit een game</h3>
            </div>
            <div class="task-score">5 pt</div>
          </div>
          <div class="task-row">
            <div class="task-content">
              <h3>Pull een legendary uit een (gouden) kist Clash Royale</h3>
            </div>
            <div class="task-score">4 pt</div>
          </div>
          <div class="task-row">
            <div class="task-content">
              <h3>Versla 2 champions in Zwaarden en Sandalen 2</h3>
            </div>
            <div class="task-score">3 pt</div>
          </div>
          <div class="task-row">
            <div class="task-content">
              <h3>Win een battle royale</h3>
            </div>
            <div class="task-score">2 pt</div>
          </div>
          <div class="task-row">
            <div class="task-content">
              <h3>Win een potje Stumble Guys (telefoon)</h3>
            </div>
            <div class="task-score">1 pt</div>
          </div>
        </div>

        <!-- Week 3: TikTok week -->
        <section class="countdown-container">
          <h2 class="countdown-title" id="week3Title">Countdown naar<br>'Week 3'</h2>
          <div class="countdown-timer" id="countdownTimer-3">
            <div class="countdown-unit">
              <span class="countdown-number" id="days-3">--</span>
              <span class="countdown-label">Dagen</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="hours-3">--</span>
              <span class="countdown-label">Uren</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="minutes-3">--</span>
              <span class="countdown-label">Minuten</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="seconds-3">--</span>
              <span class="countdown-label">Seconden</span>
            </div>
          </div>
        </section>

        <div id="week3Tasks" class="week-tasks" style="display:none;">
          <h2 class="week-title">📱 Week 3 – TikTok Week</h2>
          <p><strong>Challenge:</strong> Wie haalt de meeste views op TikTok? <em>Views kopen is verboden.</em></p>
          <ul>
            <li>Meeste views = <strong>5 punten</strong></li>
            <li>Minste views = <strong>0 punten</strong></li>
          </ul>
        </div>

        <!-- Week 4: Airport Chaos -->
        <section class="countdown-container">
          <h2 class="countdown-title" id="week4Title">Countdown naar<br>'Week 4'</h2>
          <div class="countdown-timer" id="countdownTimer-4">
            <div class="countdown-unit">
              <span class="countdown-number" id="days-4">--</span>
              <span class="countdown-label">Dagen</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="hours-4">--</span>
              <span class="countdown-label">Uren</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="minutes-4">--</span>
              <span class="countdown-label">Minuten</span>
            </div>
            <div class="countdown-unit">
              <span class="countdown-number" id="seconds-4">--</span>
              <span class="countdown-label">Seconden</span>
            </div>
          </div>
        </section>

        <div id="week4Tasks" class="week-tasks" style="display:none;">
          <h2 class="week-title">🛫 Week 4 – Airport Chaos</h2>
          <p>Opdrachten worden hier zichtbaar zodra de countdown is afgelopen!</p>
        </div>
      </div>
    </div>

    <!-- Spelregels Tab -->
    <div id="rules" class="tab-content">
      <div class="rules-page">
        <h1>📜 Spelregels – Battle Royale</h1>

        <section>
          <h2>🎯 Doel van het spel</h2>
          <p>Het doel is simpel maar genadeloos: <strong>zorg dat je niet als laatste eindigt.</strong></p>
        </section>

        <section>
          <h2>📅 Spelverloop</h2>
          <p>Het spel loopt gedurende <strong>4 weken voorafgaand aan Geldverpatsdag XXL</strong>.</p>
          <ul>
            <li>Elke vrijdag om <strong>17:00</strong> verschijnen er 5 nieuwe opdrachten online.</li>
            <li>Opdrachten leveren 1 t/m 5 punten op, afhankelijk van moeilijkheidsgraad.</li>
          </ul>
        </section>

        <section>
          <h2>📝 Opdrachten</h2>
          <ul>
            <li>Iedere speler mag <strong>één opdracht per week</strong> kiezen en uitvoeren.</li>
            <li>De uitvoering moet bij de spelleiding (<em>Stan en Thomas</em>) worden ingediend.</li>
            <li>Bewijsmateriaal: meestal in de vorm van een <strong>video</strong>, tenzij anders vermeld.</li>
            <li>Punten worden alleen toegekend na goedkeuring door de spelleiding.</li>
          </ul>
        </section>

        <section>
          <h2>⚔️ Puntensysteem</h2>
          <p>Per week zijn er maximaal <strong>5 punten</strong> te behalen.</p>
          <p>Omdat er meer spelers zijn dan opdrachten, kan <strong>minstens één speler géén punten</strong> scoren in een weekend.</p>
          <p><strong>Tactiek is cruciaal:</strong> kies slim en voorkom dat jij achterblijft.</p>
        </section>

        <section>
          <h2>💀 Verlies</h2>
          <p>Degene die na 4 weken onderaan het klassement staat, is de grote verliezer.</p>
          <p>Deze speler begint Geldverpatsdag XXL met een <strong>vervelende straf</strong>.</p>
        </section>

        <section>
          <h2>👑 Winst</h2>
          <p>De winnaar wint macht: je mag iemand (inclusief jezelf) belonen met een <strong>mystery prijs</strong>.</p>
          <ul>
            <li>Kies je voor jezelf? Dan neem je een risico.</li>
            <li>Kies je voor een ander? Misschien koop je daarmee voordeel.</li>
            <li><em>Stan en Thomas zijn niet verkiesbaar.</em></li>
          </ul>
        </section>

        <section>
          <h2>⚖️ Samenvatting</h2>
          <ul>
            <li>4 weken → 5 opdrachten per week (1–5 punten).</li>
            <li>1 opdracht per speler per week.</li>
            <li>Bewijs inleveren bij Stan & Thomas.</li>
            <li>Niet laatste worden = hoofddoel.</li>
            <li>Winnaar beslist mystery prijs.</li>
            <li>Verliezer krijgt straf bij Geldverpatsdag XXL.</li>
          </ul>
        </section>
      </div>
    </div>

    <!-- Scoreboard Tab -->
    <div id="scoreboard" class="tab-content">
      <header class="header">
        <h1>Scorebord</h1>
        <div class="current-round">
          <span class="round-label">Huidige Ronde:</span>
          <span class="round-number" id="currentRound">1</span>
        </div>
      </header>

      <div class="scoreboard">
        <div class="scoreboard-header">
          <div class="header-position">Positie</div>
          <div class="header-name">Naam</div>
          <div class="header-score">Score</div>
        </div>
        <div id="playersList" class="players-list"></div>
      </div>
    </div>

    <!-- Modal for viewing images/videos -->
    <div id="mediaModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="mediaContainer"></div>
      </div>
    </div>

    <!-- Password Modal -->
    <div id="passwordModal">
      <div class="password-modal-content">
        <h3>🔒 Preview Mode</h3>
        <p>Voer het wachtwoord in om preview modus te activeren:</p>
        <input type="password" id="passwordInput" placeholder="Wachtwoord..." />
        <div class="password-buttons">
          <button class="password-btn cancel" onclick="closePasswordModal()">Annuleren</button>
          <button class="password-btn confirm" onclick="checkPassword()">Bevestigen</button>
        </div>
      </div>
    </div>
  </div>

  <button id="previewButton">🔒 Preview</button>

  <script>
    // ================================
    // TAB FUNCTIONALITY
    // ================================
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
      const tabContent = document.getElementById(tabName);
      if (tabContent) tabContent.classList.add('active');
      if (event && event.target) event.target.classList.add('active');
    }

    // ================================
    // MULTI-WEEK COUNTDOWNS
    // ================================
    const weeks = [
      {
        id: 1,
        name: 'Drankweek',
        date: new Date('2025-08-22T17:00:00'),
        timerId: 'countdownTimer-1',
        titleSelector: '#week1Title',
        tasksId: 'week1Tasks',
      },
      {
        id: 2,
        name: 'Game Week',
        date: new Date('2025-08-29T17:00:00'),
        timerId: 'countdownTimer-2',
        titleSelector: '#week2Title',
        tasksId: 'week2Tasks',
      },
      {
        id: 3,
        name: 'TikTok Week',
        date: new Date('2025-09-05T17:00:00'),
        timerId: 'countdownTimer-3',
        titleSelector: '#week3Title',
        tasksId: 'week3Tasks',
      },
      {
        id: 4,
        name: 'Airport Chaos',
        date: new Date('2025-09-12T17:00:00'),
        timerId: 'countdownTimer-4',
        titleSelector: '#week4Title',
        tasksId: 'week4Tasks',
      },
    ];

    function revealWeek(week) {
      // Hide timer & show tasks
      const timerEl = document.getElementById(week.timerId);
      const tasksEl = document.getElementById(week.tasksId);
      if (timerEl) timerEl.style.display = 'none';
      if (tasksEl) tasksEl.style.display = 'block';

      // Update title text
      const titleEl = document.querySelector(week.titleSelector);
      if (titleEl) titleEl.textContent = `${week.name} is live!`;

      // Show Scoreboard tab once Week 1 is live (or any week after that)
      const scoreboardTab = document.getElementById('scoreboardTab');
      if (scoreboardTab) scoreboardTab.style.display = 'inline-block';
    }

    function updateCountdownForWeek(week) {
      const now = new Date();
      const timeLeft = week.date - now;

      if (timeLeft <= 0) {
        // Already revealed? Skip rework
        const tasksEl = document.getElementById(week.tasksId);
        if (tasksEl && tasksEl.style.display !== 'block') {
          revealWeek(week);
        }
        return;
      }

      const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
      const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

      // Update UI numbers
      const setText = (id, val) => {
        const el = document.getElementById(id);
        if (el) el.textContent = String(val).padStart(2, '0');
      };
      setText(`days-${week.id}`, days);
      setText(`hours-${week.id}`, hours);
      setText(`minutes-${week.id}`, minutes);
      setText(`seconds-${week.id}`, seconds);
    }

    function tickAllCountdowns() {
      weeks.forEach(updateCountdownForWeek);
    }

    // Start countdown updates
    setInterval(tickAllCountdowns, 1000);
    tickAllCountdowns();

    // ================================
    // SCOREBOARD FUNCTIONALITY (onafhankelijk van countdowntabs)
    // ================================
    const currentRound = 1;

    const playersData = {
      "Willem": [
        // { week: 1, task: "5 atjes op een avond inclusief videoproof", points: 5, proof: "media/willem_5atjes.mp4", proofType: "video" }
      ],
      "Niels": [
        // { week: 1, task: "Maak een XL Turbo shot voor jezelf en stuur een video dat je 'm neemt", points: 4, proof: "media/niels_xlturbo.mp4", proofType: "video" }
      ],
      "Daan": [
        // { week: 1, task: "Gasolina met cola voor de color (normaal glas) met bijbehorende video", points: 3, proof: "media/daan_gasolina.mp4", proofType: "video" }
      ],
      "Rutger": [
        // { week: 1, task: "Atje tripel/cocktail >10% met bewijsmateriaal", points: 2, proof: "media/rutger_tripel.jpg", proofType: "image" }
      ],
      "Mark": [
        { week: 1, task: "XL Turbo Shot", points: 4, proof: "Proof/Mark1.mp4", proofType: "video" }
      ],
      "Rogier": [
        //
      ]
    };

    let previousRankings = {};

    function calculatePlayerScores() {
      const scores = {};
      Object.keys(playersData).forEach(playerName => {
        const playerTasks = playersData[playerName];
        const totalScore = playerTasks.reduce((sum, task) => sum + task.points, 0);
        const currentRoundTasks = playerTasks.filter(task => task.week === currentRound);
        const currentRoundScore = currentRoundTasks.reduce((sum, task) => sum + task.points, 0);
        scores[playerName] = { total: totalScore, currentRound: currentRoundScore, tasks: playerTasks };
      });
      return scores;
    }

    function createRankings(scores) {
      return Object.entries(scores)
        .sort(([, a], [, b]) => b.total - a.total)
        .map(([name, data], index) => ({ position: index + 1, name, ...data }));
    }

    function getPositionChange(playerName, currentPosition) {
      if (!previousRankings[playerName]) return null;
      const previousPosition = previousRankings[playerName];
      const change = previousPosition - currentPosition;
      if (change > 0) return { direction: 'up', amount: change };
      if (change < 0) return { direction: 'down', amount: Math.abs(change) };
      return null;
    }

    function getPositionClass(position) {
      switch (position) {
        case 1: return 'gold';
        case 2: return 'silver';
        case 3: return 'bronze';
        default: return 'regular';
      }
    }

    function renderScoreboard() {
      const scores = calculatePlayerScores();
      const rankings = createRankings(scores);
      const playersList = document.getElementById('playersList');
      document.getElementById('currentRound').textContent = currentRound;
      playersList.innerHTML = '';

      rankings.forEach(player => {
        const positionChange = getPositionChange(player.name, player.position);
        const playerRow = document.createElement('div');
        playerRow.className = 'player-row';
        playerRow.onclick = () => togglePlayerDetails(player.name);
        playerRow.innerHTML = `
          <div class="position">
            <div class="position-badge ${getPositionClass(player.position)}">${player.position}</div>
            ${positionChange ? `
              <span class="position-change ${positionChange.direction}">
                <span class="material-icons">${positionChange.direction === 'up' ? 'keyboard_arrow_up' : 'keyboard_arrow_down'}</span>
                ${positionChange.amount}
              </span>
            ` : ''}
          </div>
          <div class="player-name">${player.name}</div>
          <div class="player-score">
            <span class="total-score">${player.total}</span>
            ${player.currentRound > 0 ? `<span class="round-score">+${player.currentRound}</span>` : ''}
          </div>
          <div class="player-details" id="details-${player.name}">
            ${renderPlayerDetails(player.tasks)}
          </div>
        `;
        playersList.appendChild(playerRow);
        previousRankings[player.name] = player.position;
      });
    }

    function renderPlayerDetails(tasks) {
      if (!tasks || tasks.length === 0) return '<p>Nog geen taken voltooid.</p>';
      const sortedTasks = [...tasks].sort((a, b) => a.week - b.week);
      return `
        <div class="details-header">
          <div>Week</div>
          <div>Opdracht</div>
          <div>Punten</div>
          <div>Bewijs</div>
        </div>
        ${sortedTasks.map(task => `
          <div class="detail-row">
            <div class="week-number">${task.week}</div>
            <div class="task-description">${task.task}</div>
            <div class="points">${task.points} pt</div>
            <div>
              <button class="proof-media" onclick="openMedia('${task.proof}', '${task.proofType}', event)">
                ${task.proofType === 'image' ? '📷 Foto' : '🎬 Video'}
              </button>
            </div>
          </div>
        `).join('')}
      `;
    }

    function togglePlayerDetails(playerName) {
      const detailsElement = document.getElementById(`details-${playerName}`);
      const playerRow = detailsElement.closest('.player-row');
      document.querySelectorAll('.player-details.show').forEach(details => {
        if (details !== detailsElement) {
          details.classList.remove('show');
          details.closest('.player-row').classList.remove('expanded');
        }
      });
      detailsElement.classList.toggle('show');
      playerRow.classList.toggle('expanded');
    }

    function openMedia(mediaPath, mediaType, event) {
      if (event) event.stopPropagation();
      const modal = document.getElementById('mediaModal');
      const mediaContainer = document.getElementById('mediaContainer');
      if (mediaType === 'image') {
        mediaContainer.innerHTML = `<img src="${mediaPath}" alt="Bewijs foto">`;
      } else {
        mediaContainer.innerHTML = `
          <video controls autoplay>
            <source src="${mediaPath}" type="video/mp4">
            Je browser ondersteunt geen video.
          </video>
        `;
      }
      modal.style.display = 'block';
    }

    function closeMedia() {
      document.getElementById('mediaModal').style.display = 'none';
      document.getElementById('mediaContainer').innerHTML = '';
    }

    // ================================
    // PREVIEW MODE
    // ================================
    function activatePreviewMode() {
      // Reveal all weeks & hide all timers
      weeks.forEach(week => revealWeek(week));
      const titleEls = document.querySelectorAll('.countdown-title');
      titleEls.forEach(el => el.textContent = 'Preview Mode Actief');
    }

    function showPasswordModal() {
      document.getElementById('passwordModal').style.display = 'block';
      document.getElementById('passwordInput').focus();
    }

    function closePasswordModal() {
      document.getElementById('passwordModal').style.display = 'none';
      document.getElementById('passwordInput').value = '';
    }

    function checkPassword() {
      const password = document.getElementById('passwordInput').value;
      if (password === 'NielsisKaal') {
        activatePreviewMode();
        closePasswordModal();
      } else {
        alert('Onjuist wachtwoord');
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordInput').focus();
      }
    }

    // ================================
    // DOM CONTENT LOADED EVENT
    // ================================
    document.addEventListener('DOMContentLoaded', function () {
      renderScoreboard();
      document.querySelector('.close').onclick = closeMedia;
      document.getElementById('mediaModal').onclick = function (event) {
        if (event.target === this) closeMedia();
      };

      const previewButton = document.getElementById('previewButton');
      if (previewButton) {
        previewButton.addEventListener('click', showPasswordModal);
      }

      // Password modal Enter key support
      document.getElementById('passwordInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') checkPassword();
      });

      // Close password modal when clicking outside
      document.getElementById('passwordModal').addEventListener('click', function (e) {
        if (e.target === this) closePasswordModal();
      });
    });
  </script>
</body>
</html>
